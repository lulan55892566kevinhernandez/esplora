doctype html

- baseTitle = process.env.SITE_TITLE || 'Block Explorer'
- staticRoot = process.env.STATIC_ROOT || ''
- pageTitle = prerender_title ? `${prerender_title} Â· ${baseTitle}` : baseTitle
- bodyClass = theme ? `theme-${theme}` : ''

- cssPath = t ? t`style.css` : 'style.css'
- lang = t ? t.lang_id : 'en'
- dir = t ? t`ltr` : 'ltr'

head
  meta(charset='utf-8')
  title= pageTitle
  meta(property='og:title', content=process.env.OG_TITLE || process.env.SITE_TITLE || 'Block explorer')
  meta(name='description', content=process.env.SITE_DESC || 'Esplora Block Explorer')

  if canon_url
    link(rel="canonical", href=canon_url)

  if !noscript && process.env.NOSCRIPT_REDIR
    //- we typically cannot put the current requested path into the HTML when this is served as a static HTML page, so
    //- we issue a redirect to "?nojs", which is then caught server-side and redirected again to the actual nojs location.

    //- with some script block extensions, redirecting to "?nojs" does not retain the original request path,
    //- but instead redirects to the root path. to support them, we need something external to generate dynamic
    //- HTML pages with the requested path injected into the HTML page. This can be done using nginx with the
    //- http_sub module and this directive: ```sub_filter '{{REQUEST_PATH}}' '$uri';```, which replaces {{REQUEST_PATH}}
    //- with the actual requested path. NOSCRIPT_REDIRECT_EXTERNAL_REWRITE indicates that this rewrite is in place
    //- and can be used, which also requires setting NOSCRIPT_REDIRECT_BASE with the base url of the nojs server.

    - noscript_redir_url = !process.env.NOSCRIPT_REDIR_EXTERNAL_REWRITE ? '?nojs' : process.env.NOSCRIPT_REDIR_BASE.replace(/\/+$/, '') + '{{REQUEST_PATH}}'
    noscript: meta(http-equiv='refresh', content=`0; url='${noscript_redir_url}'`)

  base(href=process.env.BASE_HREF || '/')

  meta(name='viewport', content='width=device-width, initial-scale=1')
  link(rel='shortcut icon', type='image/png', href=staticRoot+'img/favicon.png')
  link(rel='stylesheet', href=staticRoot+'bootstrap.min.css')
  link(rel='stylesheet', href=staticRoot+cssPath)

  if process.env.CANONICAL_URL
    //- open search requires the absolute URL of the explorer
    link(rel='search', href=staticRoot+'opensearch.xml', type='application/opensearchdescription+xml', title=process.env.SITE_TITLE || 'Block Explorer')

  != process.env.HEAD_HTML

body(class=bodyClass, lang=lang, dir=dir)
  #explorer!= prerender_html || ''

  if !noscript
    script(src=staticRoot+'app.js', async)
  != process.env.FOOT_HTML
